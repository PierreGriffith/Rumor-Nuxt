var SVGPopWatch=(function(){a.TimeUpdater=(function(){function c(d){this.parent=d.parent;this.updateInterval=d.updateInterval;this.displaySeconds=d.displaySeconds;this.computeTimeAndDate(d.customDate);this.updaterSetup()}c.prototype.computeTimeAndDate=function(d){if(d){this.initialDate=new Date(d)}else{this.initialDate=new Date()}this.time={hours:this.initialDate.getHours(),minutes:this.initialDate.getMinutes(),seconds:this.initialDate.getSeconds(),milliseconds:this.initialDate.getMilliseconds()};this.date={year:this.initialDate.getFullYear(),month:this.initialDate.getMonth(),day:this.initialDate.getDate()}};c.prototype.updaterSetup=function(){if(this.updateInterval==="stop"){return}if(this.updateInterval>1000){this.initialDelay=(60-this.time.seconds)*1000;setTimeout(b(this,function(){this.updateTime();setInterval(b(this,this.updateTime),this.updateInterval)}),this.initialDelay)}else{setInterval(b(this,this.updateTime),this.updateInterval)}var e=new Date(this.date.year,this.date.month,this.date.day,24,0,0,0);var d=e.getTime()-this.initialDate.getTime();setTimeout(b(this,function(){this.updateDate();setInterval(b(this,this.updateDate),86400000)}),d)};c.prototype.updateDate=function(){var d=new Date(this.date.year,this.date.month,this.date.day);d.setDate(d.getDate()+1);this.date.year=d.getFullYear();this.date.month=d.getMonth();this.date.day=d.getDate();window.dispatchEvent(this.parent.dateUpdatedEvent)};c.prototype.updateTime=function(){var d=new Date(0,0,0,this.time.hours,this.time.minutes,this.time.seconds,this.time.milliseconds);d.setTime(d.getTime()+this.updateInterval);this.time.hours=d.getHours();this.time.minutes=d.getMinutes();this.time.seconds=d.getSeconds();this.time.milliseconds=d.getMilliseconds();window.dispatchEvent(this.parent.timeUpdatedEvent)};return c})();a.SizeUpdater=(function(){function c(d){this.parent=d.parent;this.svgElement=d.svgElement;this.details=d.details;window.addEventListener("resize",b(this,this.updateSVG));this.updateSVG()}c.prototype.updateSVG=function(){var d=this.svgElement.getBoundingClientRect().width;if(d<64){this.hideLabels();this.hideWeather()}else{if(d<96){this.showLabels();this.hideWeather()}else{this.showLabels();this.showWeather()}}};c.prototype.hideLabels=function(){if(!this.parent.clockLabels){return}this.parent.clockLabels.attr({opacity:0})};c.prototype.hideWeather=function(){this.isWeatherVisible=false;if(!this.parent.weatherUpdater){return}this.parent.weatherUpdater.weatherDetails.attr({opacity:0})};c.prototype.showLabels=function(){if(!this.parent.clockLabels){return}this.parent.clockLabels.attr({opacity:this.parent.clockStyle.fillOpacity})};c.prototype.showWeather=function(){this.isWeatherVisible=true;if(!this.parent.weatherUpdater){return}this.parent.weatherUpdater.weatherDetails.attr({opacity:this.parent.weatherStyle.opacity})};return c})();a.PointerUpdater=(function(){function c(d){this.parent=d.parent;this.hoursPointer=d.hoursPointer;this.minutesPointer=d.minutesPointer;this.secondsPointer=d.secondsPointer;window.addEventListener("timeUpdated",b(this,this.updatePointers))}c.prototype.updatePointers=function(){if(this.parent.timeUpdater.displaySeconds){this.secondPointerAngle=this.parent.timeUpdater.time.seconds*6;this.rotatePointer(this.secondsPointer,this.secondPointerAngle,"128 128")}this.minutePointerAngle=this.parent.timeUpdater.time.minutes*6+this.parent.timeUpdater.time.seconds*0.1;this.rotatePointer(this.minutesPointer,this.minutePointerAngle,"128 128");this.hourPointerAngle=((this.parent.timeUpdater.time.hours%12)*30)+(this.parent.timeUpdater.time.minutes*0.5);this.rotatePointer(this.hoursPointer,this.hourPointerAngle,"128 128")};c.prototype.rotatePointer=function(f,e,d){f.attr({transform:"r"+e+" "+d})};return c})();a.WeatherUpdater=(function(){function c(d){this.parent=d.parent;this.weatherLocation=d.weatherLocation;this.weatherPath=d.weatherPath;this.updateWeather();setInterval(b(this,this.updateWeather),1000*60*60)}c.prototype.updateWeather=function(){var d=new XMLHttpRequest();if(this.parent.weatherDate){d.open("GET","http://api.openweathermap.org/data/2.5/forecast/daily?q="+this.weatherLocation.city+","+this.weatherLocation.country+"&cnt="+this.parent.weatherDate+"&APPID=4b8d50c3bbf4b20b2a5dcd37bd580aae",true)}else{d.open("GET","http://api.openweathermap.org/data/2.5/weather?q="+this.weatherLocation.city+","+this.weatherLocation.country+"&APPID=4b8d50c3bbf4b20b2a5dcd37bd580aae",true)}d.onload=b(this,function(g){if(d.readyState===4){if(d.status===200){var f=JSON.parse(d.responseText);if(this.parent.weatherDate){this.weatherCode=f.list[this.parent.weatherDate-1].weather[0].icon}else{this.weatherCode=f.weather[0].icon}Snap.load(this.weatherPath+this.weatherCode+".svg",b(this,this.onWeatherLoaded))}else{console.error(d.statusText)}}});d.onerror=function(f){console.error(d.statusText)};d.send(null)};c.prototype.onWeatherLoaded=function(f){if(this.weatherDetails){this.weatherDetails.animate({opacity:0},500,mina.easeinout);this.weatherDetails.remove()}this.parent.snap.append(f.select("#weather"));this.weatherDetails=this.parent.snap.select("#weather");this.weatherDetails.insertAfter(this.parent.clockZone);this.weatherDetails.attr({opacity:0,transform:"s"+this.parent.pointerScaleFactor+" "+this.parent.pointerScaleFactor+" 128 128"});var e=this.weatherDetails.selectAll("*");if(this.parent.weatherStyle.style==="monochrome"){var d=this;e.forEach(function(g){g.attr({fill:d.parent.weatherStyle.color,stroke:d.parent.weatherStyle.color})})}else{if(this.parent.weatherStyle.style==="stroke-only"){var d=this;e.forEach(function(g){g.attr({stroke:d.parent.weatherStyle.color,fillOpacity:0})})}}this.weatherDetails.animate({opacity:this.parent.sizeUpdater.isWeatherVisible?this.parent.weatherStyle.opacity:0},1000,mina.easeinout)};return c})();function a(d){this.targetElementId="svg",this.clockBasePath="svg/base/",this.clockPointersPath="svg/pointers/",this.weatherPath="svg/weather/",this.clockStyle={watchFace:"base1.svg",fill:"#fff",fillOpacity:1,stroke:"#000",strokeOpacity:1,labelColor:"#000"};this.pointerStyle={pointers:"pointers11.svg",hours:{fill:"#000",fillOpacity:1,stroke:"#000",strokeOpacity:1},minutes:{fill:"#000",fillOpacity:1,stroke:"#000",strokeOpacity:1},seconds:{fill:"#000",fillOpacity:1,stroke:"#000",strokeOpacity:1}};this.weatherStyle={style:"default",color:"#000",opacity:1};this.updateInterval=1000;this.displaySeconds=true;this.info={weather:true};this.weatherLocation={city:"south boston",country:"us"};for(var c in d){this[c]=d[c]}this.createEvents();this.snapSetup()}a.prototype.createEvents=function(){this.timeUpdatedEvent=document.createEvent("Event");this.timeUpdatedEvent.initEvent("timeUpdated",true,true);this.dateUpdatedEvent=document.createEvent("Event");this.dateUpdatedEvent.initEvent("dateUpdated",true,true)};a.prototype.snapSetup=function(){this.snap=Snap("#"+this.targetElementId);this.svgElement=document.getElementById(this.targetElementId);Snap.load(this.clockBasePath+this.clockStyle.watchFace,b(this,this.onWatchFaceLoaded));Snap.load(this.clockPointersPath+this.pointerStyle.pointers,b(this,this.onPointersLoaded))};a.prototype.initWatchFace=function(){if(this.clockStyle.strokeWidth){this.innerClockRadius=128-(this.clockStyle.strokeWidth/2)}else{this.innerClockRadius=this.clockZone.attr("r");this.clockStyle.strokeWidth=256-2*this.innerClockRadius}this.clockZone.attr(this.clockStyle);this.clockZone.attr({transform:"r-90",strokeDasharray:this.clockZone.perimeter,strokeDashoffset:-this.clockZone.perimeter,fillOpacity:0,r:this.innerClockRadius});var d=128-this.clockStyle.strokeWidth-8;var f=d/(this.clockLabels.getBBox().w/2);this.clockLabels.attr({opacity:0,transform:"s"+f});var e=this.clockLabels.selectAll("*");var c=this;e.forEach(function(g){g.attr({opacity:0,fill:c.clockStyle.labelColor,stroke:c.clockStyle.labelColor})});this.showWatchFace()};a.prototype.initPointers=function(){this.pointerScaleFactor=(116-this.clockStyle.strokeWidth)/116;this.pointerGroup.attr({opacity:0,transform:"s0.05 0.05 128 128"});var c=this;this.hoursPointer.attr({transform:"r"+this.hourPointerAngle+" 128 128"});this.hoursPointer.attr(this.pointerStyle.hours);var e=this.hoursPointer.selectAll("*");e.forEach(function(g){g.attr(c.pointerStyle.hours)});this.minutesPointer.attr({transform:"r"+this.minutePointerAngle+" 128 128"});this.minutesPointer.attr(this.pointerStyle.minutes);var f=this.minutesPointer.selectAll("*");f.forEach(function(g){g.attr(c.pointerStyle.minutes)});if(this.displaySeconds){this.secondsPointer.attr({transform:"r"+this.secondPointerAngle+" 128 128"});this.secondsPointer.attr(this.pointerStyle.seconds);var d=this.secondsPointer.selectAll("*");d.forEach(function(g){g.attr(c.pointerStyle.seconds)})}else{this.secondsPointer.attr({opacity:0})}};a.prototype.showWatchFace=function(){this.clockZone.animate({"stroke-dashoffset":"0"},1000,mina.easein,b(this,function(){this.clockLabels.animate({opacity:this.clockStyle.fillOpacity},1000,mina.easein);this.clockZone.animate({fillOpacity:this.clockStyle.fillOpacity,strokeOpacity:this.clockStyle.strokeOpacity},1000,mina.easeinout);var d=this.clockLabels.selectAll("*");var c=this;d.forEach(function(e){e.animate({opacity:c.clockStyle.fillOpacity},1000,mina.easein)});this.showPointers()}))};a.prototype.showPointers=function(){this.pointerGroup.animate({opacity:1,transform:"s"+this.pointerScaleFactor+" "+this.pointerScaleFactor+" 128 128"},1000,mina.easeinout)};a.prototype.onWatchFaceLoaded=function(c){this.snap.append(c.select("#clock-zone"));this.snap.append(c.select("#clock-labels"));this.clockZone=this.snap.select("#clock-zone");this.clockLabels=this.snap.select("#clock-labels");this.clockZone.perimeter=4*Math.PI*this.clockZone.attr("r");this.clockGroup=this.snap.group(this.clockZone,this.clockLabels);if(this.pointerGroup){this.clockGroup.after(this.pointerGroup)}this.initWatchFace()};a.prototype.onPointersLoaded=function(c){this.snap.append(c.select("#hours"));this.snap.append(c.select("#minutes"));this.snap.append(c.select("#seconds"));this.hoursPointer=this.snap.select("#hours");this.minutesPointer=this.snap.select("#minutes");this.secondsPointer=this.snap.select("#seconds");this.pointerGroup=this.snap.group(this.hoursPointer,this.minutesPointer,this.secondsPointer);this.initPointers();this.sizeUpdater=new a.SizeUpdater({parent:this,svgElement:this.svgElement});this.pointerUpdater=new a.PointerUpdater({parent:this,hoursPointer:this.hoursPointer,minutesPointer:this.minutesPointer,secondsPointer:this.secondsPointer});this.timeUpdater=new a.TimeUpdater({parent:this,updateInterval:this.updateInterval,displaySeconds:this.displaySeconds,customDate:this.customDate});if(this.info.weather){this.weatherUpdater=new a.WeatherUpdater({parent:this,weatherLocation:this.weatherLocation,weatherPath:this.weatherPath})}};function b(d,c){return function(){return c.apply(d,arguments)}}return a})();